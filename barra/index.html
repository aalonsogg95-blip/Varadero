<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Barra</title>
    <!-- CSS -->
    <link rel="stylesheet" href="index.css">
    <!-- INCLUIR JQUERY -->
    <script src="../jquery/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="../boostrap/bootstrap.min.css">
    <link rel="stylesheet" href="../remixicon.css">
    <!-- ICONO -->
    <link rel="shortcut icon" type='image/x-icon' href='../img/drink.png'>
</head>
<body>
   
    <div class='contenedor_card'>
         <!-- FORMULARIO -->
         <section class='cuadro'>
            <div class="cuadro_imagen">
                <img src="../img/varadero_logo.png" class="cuadro_img">
            </div>
            <h1 class='cuadro_title'>Iniciar sesión</h1>
            <p class="cuadro_subtitle">Barra</p> 

            <form class="w-60 m-auto formulario" id="formulario">
                <div class="form-group">
                    <label for="fieldUsuario"><i class="ri-user-fill"></i>Usuario</label>
                    <input type="text" class="form-control" id="fieldUsuario">
                    <div class="invalid-feedback">
                        Campo vacio
                    </div>
                </div>
                <div class="form-group">
                    <label for="fieldPassword"><i class="ri-lock-fill"></i>Contraseña</label>
                    <input type="password" class="form-control " id="fieldPassword">
                    <!-- is-invalid -->
                    <div class="invalid-feedback">
                        Campo vacio
                    </div>
                </div>
                
            </form>

            <button class="btn btn-md" type="button" onclick='entrar()'>Entrar</button>
            
        </section>
    </div>
    
   
   
    
</body>
</html>

<script src='../jquery/usuario.js'></script>
<!--CODIGO JS -->
<script type='text/javascript'>

let contenedor= document.querySelector('.cuadro');
    
    function entrar(){
        let usu=document.querySelector('#fieldUsuario').value;
        let con=document.querySelector('#fieldPassword').value;
        
     
         $.ajax({
				type:'POST',
				url:'sesion.php',
                beforeSend: function() { Spinner()},
                complete: function() { ocultarSpinner()},
				data:{usu,con},
				success:function(respo){
					var res=eval(respo);
                    
                    if(res>0){
                       //SI ESTA REGISTRADO
                        sessionStorage.setItem("usserBar",usu.toLowerCase());
                        window.location.href="barra.html";
                    }else{
                       //NO ESTA REGISTRADO
                      //NO ESTA REGISTRADO
                      const divMensaje =document.createElement('div');
                        divMensaje.classList.add('text-center','alert','d-block','col-12,','divMensaje');
                        divMensaje.classList.add('alert-danger');

                        divMensaje.textContent="Usuario y/o contraseña incorrectos";

                        contenedor.insertBefore(divMensaje, document.querySelector('.btn'));

                        setTimeout(()=>{
                            divMensaje.remove();
                        }, 5000);
                    }
                    
				}
			});
     
    }


    function ocultarSpinner(){
        document.querySelector('.spinner').remove();
     }

      //SPINNER DE CARGANDO
    function Spinner(){
        const divSpinner = document.createElement('div');
        divSpinner.classList.add('spinner');
        divSpinner.innerHTML=`
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>`;
        contenedor.appendChild(divSpinner);
    }
    
</script>